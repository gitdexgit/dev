#!/bin/bash

# --- START OF CONFIGURATION ---
# PASTE YOUR IMGUR API CREDENTIALS HERE
export IMGUR_API_ID="976495ae3744eb6"
export IMGUR_API_SECRET="defe65993fa1c7c52420a9305148830b8f460df0"
# --- END OF CONFIGURATION ---

# The full path to your project's venv activate script
source /home/dex/scripts/tools/python/imgur/venv/bin/activate

# Check if required credentials are set
if [ -z "$IMGUR_API_ID" ] || [ "$IMGUR_API_ID" == "YOUR_CLIENT_ID_HERE" ]; then
    echo "ERROR: You need to set your IMGUR_API_ID in the script." >&2
    deactivate
    exit 1
fi

# Check if a command-line argument (a file path) was provided
if [ $# -gt 0 ]; then
    # If an argument exists, use it as the file path
    FILE_TO_UPLOAD="$1"
else
    # If no argument is provided, get the image from the clipboard
    echo "No file path provided. Attempting to upload from clipboard..."

    # Create a unique filename for the temporary image in the /tmp/ directory
    TMP_FILE="/tmp/screenshot-$(date +%Y-%m-%d-%H-%M-%S).png"

    # Save the image from the clipboard to the temporary file
    # The '||' part ensures the script exits if xclip fails
    if xclip -selection clipboard -t image/png -o > "$TMP_FILE"; then
        FILE_TO_UPLOAD="$TMP_FILE"
    else
        echo "ERROR: No PNG image found on the clipboard or xclip is not installed." >&2
        deactivate
        exit 1
    fi
fi

echo "Uploading $FILE_TO_UPLOAD..."

# Run the uploader with the determined file path
/home/dex/scripts/tools/python/imgur/venv/bin/imgur-uploader "$FILE_TO_UPLOAD"

# Deactivate the virtual environment, since we're done with it
deactivate
